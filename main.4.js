(()=>{"use strict";function t(...t){if(0===t.length)return;const n={};let i,s,a;if(t.forEach(((t,e)=>{const i="string"==typeof(s=t)?"string":"object"==typeof s?Array.isArray(s)?"array":s instanceof Element?"element":"object":void 0;var s;n[i]?n[i].push(e):n[i]=[e]})),n.array&&(i=n.array[0],s=t[i]),n.object&&(i=n.object[0],a=t[i]),n.element&&n.element.length>0){i=n.element[0];const o=t[i];let r;return n.string&&(i=n.string[0],r=t[i]),e(o,a,r,s)}if(n.string&&n.string.length>0){i=n.string[0];const o=t[i];let r;return n.string.length>1&&(i=n.string[1],r=t[i]),function(t,n,i,s){return e(document.createElement(t),n,i,s)}(o,a,r,s)}}function e(t,e={},n,i=[]){for(const n in e)if(Object.hasOwnProperty.call(e,n)){const i=e[n];t[n]=i}n&&(t.innerText=n);for(let e=0;e<i.length;e++){const n=i[e];n instanceof Node&&t.appendChild(n)}return t}function n(){const t=document.querySelector("header span.action");t&&("▶️"===t.innerText?t.innerText="⏸":t.innerText="▶️")}window.addEventListener("load",(async function(){const t=await async function(){return(await fetch("albums.json")).json()}(),e=document.body;window.player=new i(t,e,n,a)}));class i{constructor(t,e,n,i){this.albums=t,this.audios=[],this.albumN=2,this.trackN=0,this.onToggle=n,this.updateView=i,this.loadTrack();const s=this;e.addEventListener("click",(function(){s.toggle()})),e.addEventListener("keypress",(function(t){"Space"===t.code&&s.toggle()})),e.addEventListener("touch",(function(){s.toggle()}))}toggle(){this.on?this.pause():this.play(),this.on=!this.on}loadTrack(t,e){t&&(this.albumN=t),e&&(this.trackN=e);const n=this.albums[this.albumN].tracks[this.trackN].path,i=new Audio(n);this.audios.push(i)}unloadTrack(){return this.audios.shift()}nextTrack(){const t=this.albums[this.albumN].tracks.length;this.trackN===t-1?(this.trackN=0,this.nextAlbum()):this.trackN+=1}nextAlbum(){let t=this.albums.length;this.albumN===t-1?this.albumN=0:this.albumN+=1}play(){let t=!1;this.audio||(this.audio=this.unloadTrack(),this.album=this.albums[this.albumN],this.track=this.album.tracks[this.trackN],t=!0,this.nextTrack(),this.loadTrack());const e=this,n=this.audio;n.play();const i=()=>{e.onToggle(),e.updateView()},s=()=>{e.onToggle(),e.updateView(e.album,e.track)};t&&(n.addEventListener("ended",(function t(){n.removeEventListener("ended",t),n.removeEventListener("pause",i),n.removeEventListener("play",s),delete e.audio,e.updateView(),e.play()})),n.addEventListener("pause",i),n.addEventListener("play",s))}pause(){this.audio&&this.audio.pause(),this.updateView()}}let s;function a(e,n){document.body.offsetWidth<900||(e||n?(s=function(e,n){return t("div",{className:"player-view"},[t("div",{className:"front"},[t("img",{src:e.cover}),t("h2",e.title),t("h3",n.title)]),t("div",{className:"back"},[t("img",{src:e.cover})])])}(e,n),document.body.appendChild(s),setTimeout((function(){const t=document.querySelector(".player-view .back");t&&t.classList.add("active")}),200)):s&&s.parentNode&&s.parentNode.removeChild(s))}})();