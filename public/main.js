(()=>{"use strict";function t(...t){if(0===t.length)return;const s={};let n,i,a;if(t.forEach(((t,e)=>{const n="string"==typeof(i=t)?"string":"object"==typeof i?Array.isArray(i)?"array":i instanceof Element?"element":"object":void 0;var i;s[n]?s[n].push(e):s[n]=[e]})),s.array&&(n=s.array[0],i=t[n]),s.object&&(n=s.object[0],a=t[n]),s.element&&s.element.length>0){n=s.element[0];const o=t[n];let r;return s.string&&(n=s.string[0],r=t[n]),e(o,a,r,i)}if(s.string&&s.string.length>0){n=s.string[0];const o=t[n];let r;return s.string.length>1&&(n=s.string[1],r=t[n]),function(t,s,n,i){return e(document.createElement(t),s,n,i)}(o,a,r,i)}}function e(t,e={},s,n=[]){for(const s in e)if(Object.hasOwnProperty.call(e,s)){const n=e[s];t[s]=n}s&&(t.innerText=s);for(let e=0;e<n.length;e++){const s=n[e];s instanceof Node&&t.appendChild(s)}return t}function s(){const t=document.querySelector("header span.toggle");t&&("▶️"===t.innerText?t.innerText="⏸":t.innerText="▶️")}function n(){const t=document.querySelector("header span.shuffle");t&&("🔀"===t.innerText?t.innerText="🔁":t.innerText="🔀")}window.addEventListener("load",(async function(){const t=await async function(){return(await fetch("albums.json")).json()}(),e={playPause:document.body,shuffle:document.querySelector(".shuffle"),next:document.querySelector(".next")},a={playPause:s,updateView:r,shuffle:n};window.player=new i(t,e,a)}));class i{constructor(t,e,s){this.albums=t,this.audios=[],this.albumN=2,this.trackN=0,this.shuffle=!1,this.actions=s,this.loadTrack();const n=()=>{this.toggle()},i=t=>{t.stopPropagation(),this.toggleShuffle(),this.actions.shuffle()},a=t=>{t.stopPropagation(),this.next()};e.playPause.addEventListener("click",n),e.playPause.addEventListener("touch",n),e.playPause.addEventListener("keydown",(function(t){"Space"===t.code?n():"ArrowRight"===t.code?a(t):"KeyS"===t.code&&i(t)})),e.shuffle.addEventListener("click",i),e.shuffle.addEventListener("touch",i),e.next.addEventListener("click",a),e.next.addEventListener("touch",a)}toggle(){this.on?this.pause():this.play(),this.on=!this.on}toggleShuffle(){if(this.shuffle)this.tempShuffle&&(this.albumN=this.tempShuffle.albumN,this.trackN=this.tempShuffle.trackN,delete this.tempShuffle);else{const{albumN:t,trackN:e}=this;this.tempShuffle={albumN:t,trackN:e}}this.shuffle=!this.shuffle}loadTrack(t,e){t&&(this.albumN=t),e&&(this.trackN=e);const s=this.albums[this.albumN].tracks[this.trackN].path,n=new Audio(s);this.audios.push(n)}unloadTrack(){return this.audios.shift()}nextTrack(){if(this.shuffle)return void this.randomTrack();const t=this.albums[this.albumN].tracks.length;this.trackN===t-1?(this.trackN=0,this.nextAlbum()):this.trackN+=1}randomTrack(){const t=this.albums.length;this.albumN=a(0,t-1);const e=this.albums[this.albumN].tracks.length;this.trackN=a(0,e-1)}nextAlbum(){let t=this.albums.length;this.albumN===t-1?this.albumN=0:this.albumN+=1}play(){let t=!1;this.audio||(this.audio=this.unloadTrack(),this.album=this.albums[this.albumN],this.track=this.album.tracks[this.trackN],t=!0,this.nextTrack(),this.loadTrack());const e=this,s=this.audio;s.play();const n=()=>{e.actions.playPause(),e.actions.updateView()},i=()=>{e.actions.playPause(),e.actions.updateView(e.album,e.track)};t&&(s.addEventListener("ended",(function t(){s.removeEventListener("ended",t),s.removeEventListener("pause",n),s.removeEventListener("play",i),delete e.audio,e.actions.updateView(),e.play()})),s.addEventListener("pause",n),s.addEventListener("play",i))}next(){if(this.audio){this.audio.pause(),this.audio.currenTime=0;const t=new Event("ended");this.audio.dispatchEvent(t)}}pause(){this.audio&&this.audio.pause(),this.actions.updateView()}}function a(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}let o;function r(e,s){document.body.offsetWidth<900||(e||s?(o=function(e,s){return t("div",{className:"player-view"},[t("div",{className:"front"},[t("img",{src:e.cover}),t("h2",e.title),t("h3",s.title)]),t("div",{className:"back"},[t("img",{src:e.cover})])])}(e,s),document.body.appendChild(o),setTimeout((function(){const t=document.querySelector(".player-view .back");t&&t.classList.add("active")}),200)):o&&o.parentNode&&o.parentNode.removeChild(o))}})();